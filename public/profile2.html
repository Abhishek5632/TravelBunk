<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Companion Profile | TravelBunk</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Poppins',sans-serif;background:#f4f9f9;color:#2D3436;line-height:1.6;}
.page-hero{background:linear-gradient(135deg,#00BFA6,#FDCB6E);padding:120px 20px 70px;text-align:center;color:white;border-bottom-left-radius:50px;border-bottom-right-radius:50px;}
.page-hero h1{font-size:2.8rem;font-weight:700;margin-bottom:1rem;}
.profile-card{background:white;padding:40px;border-radius:20px;box-shadow:0 8px 25px rgba(0,0,0,0.08);max-width:800px;margin:40px auto;text-align:center;}
.profile-card img{width:160px;height:160px;border-radius:50%;object-fit:cover;margin-bottom:20px;border:4px solid #00BFA6;}
.profile-card h2{color:#00BFA6;font-size:2rem;margin-bottom:10px;}
.profile-card p{margin:6px 0;color:#555;font-weight:500;}
.btn{margin-top:10px;padding:12px 30px;border:none;border-radius:12px;background:linear-gradient(135deg,#00BFA6,#FDCB6E);color:white;font-size:1rem;cursor:pointer;font-weight:600;transition:0.3s;}
.btn:hover{opacity:0.9;transform:translateY(-2px);}
.section{margin:30px 0;text-align:left;}
.section h3{color:#00BFA6;margin-bottom:15px;font-size:1.3rem;}
.section ul{list-style:none;padding:0;}
.section ul li{background:#f1f1f1;padding:12px 15px;margin:6px 0;border-radius:12px;font-weight:500;}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:15px;margin-top:20px;}
.stat-card{background:linear-gradient(135deg,#00BFA6,#FDCB6E);color:white;padding:15px;border-radius:15px;text-align:center;}
.stat-card h4{margin-bottom:8px;font-size:1rem;font-weight:500;}
.stat-card p{font-size:1.2rem;font-weight:700;}
.chat-box{display:none;margin-top:30px;text-align:left;border:1px solid #ddd;padding:15px;border-radius:12px;background:#fff;}
.chat-messages{max-height:200px;overflow-y:auto;margin-bottom:10px;}
.chat-input{display:flex;gap:10px;}
.chat-input input{flex:1;padding:8px;border-radius:8px;border:1px solid #ccc;}
</style>
</head>
<body>

<section class="page-hero">
<h1>Companion Profile</h1>
<p>View details and connect with your travel buddy</p>
</section>

<div class="profile-card">
<img id="companionImg" src="https://randomuser.me/api/portraits/women/44.jpg" alt="Companion">
<h2 id="companionName">Loading...</h2>
<p><strong>Email:</strong> <span id="companionEmail"></span></p>
<p><strong>College:</strong> <span id="companionCollege"></span></p>
<p><strong>Destination:</strong> <span id="companionDestination"></span></p>
<p><strong>Dates:</strong> <span id="companionDates"></span></p>
<p id="companionBio"></p>

<div class="section">
<h3>Travel Stats</h3>
<div class="stats-grid">
  <div class="stat-card"><h4>Total Trips</h4><p id="trips">0</p></div>
  <div class="stat-card"><h4>Total Distance</h4><p id="distance">0 km</p></div>
  <div class="stat-card"><h4>Average Rating</h4><p id="rating">0 ⭐</p></div>
</div>
</div>

<div id="requestSection">
<button class="btn" onclick="sendRequest()">Send Connect Request</button>
</div>

<div class="section">
<h3>Trips</h3>
<ul id="tripsList"></ul>
</div>

<div class="chat-box" id="chatBox">
<h3>Chat</h3>
<div class="chat-messages" id="chatMessages"></div>
<div class="chat-input">
<input type="text" id="chatInput" placeholder="Type a message...">
<button class="btn" onclick="sendMessage()">Send</button>
</div>
</div>
</div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const userDataStr = urlParams.get("data");
let data;
try { data = userDataStr ? JSON.parse(decodeURIComponent(userDataStr)) : {}; } catch(e){ data = {}; }

document.getElementById("companionName").innerText = data.name || "Unknown";
document.getElementById("companionEmail").innerText = data.email || "N/A";
document.getElementById("companionCollege").innerText = data.college || "Independent Traveler";
document.getElementById("companionDestination").innerText = data.destination || "Anywhere";
document.getElementById("companionDates").innerText = data.start && data.end ? `${data.start} → ${data.end}` : "Flexible";
document.getElementById("companionBio").innerText = data.bio || "Explorer ✈️";
document.getElementById("companionImg").src = data.img || "https://randomuser.me/api/portraits/men/32.jpg";
document.getElementById("trips").innerText = data.trips || "0";
document.getElementById("distance").innerText = data.distance || "0 km";
document.getElementById("rating").innerText = data.rating || "0 ⭐";

// Show trips if available
const tripsList = document.getElementById("tripsList");
if(data.tripsList && data.tripsList.length){
  data.tripsList.forEach(t=>{
    const li=document.createElement("li");
    li.innerText = `${t.destination} (${t.start} → ${t.end}) ${t.college ? `- ${t.college}` : ''}`;
    tripsList.appendChild(li);
  });
}

// Connect & Chat logic
let requestSent=false, requestAccepted=false;

function sendRequest(){
  if(!requestSent){
    document.getElementById('requestSection').innerHTML=`
      <p>Request sent! Waiting for response...</p>
      <button class="btn" style="background:#27ae60;" onclick="acceptRequest()">Simulate Accept ✅</button>
      <button class="btn" style="background:#e74c3c;" onclick="rejectRequest()">Simulate Reject ❌</button>
    `;
    requestSent=true;
  }
}

function acceptRequest(){
  requestAccepted=true;
  document.getElementById('requestSection').innerHTML=`<p style="color:green;">Request Accepted ✅</p>`;
  document.getElementById('chatBox').style.display="block";
}

function rejectRequest(){
  requestAccepted=false;
  document.getElementById('requestSection').innerHTML=`<p style="color:red;">Request Rejected ❌</p>`;
  document.getElementById('chatBox').style.display="none";
}

function sendMessage(){
  const input=document.getElementById('chatInput');
  const msg=input.value.trim();
  if(msg){
    const msgBox=document.getElementById('chatMessages');
    const div=document.createElement('div');
    div.textContent="You: "+msg;
    msgBox.appendChild(div);
    input.value="";
    msgBox.scrollTop=msgBox.scrollHeight;
  }
}
</script>
</body>
</html>
