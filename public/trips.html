<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Trips | TravelBuddy</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Poppins',sans-serif;background:#f4f9f9;color:#2D3436;line-height:1.6;overflow-x:hidden;}
a{text-decoration:none;color:inherit;}
ul{list-style:none;padding-left:0;}

/* Navbar */
.navbar{background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);position:fixed;top:0;width:100%;z-index:1000;box-shadow:0 2px 10px rgba(0,0,0,0.05);}
.nav-container{max-width:1200px;margin:0 auto;padding:0 20px;display:flex;justify-content:space-between;align-items:center;height:70px;}
.nav-logo h2{color:#00BFA6;font-size:1.9rem;font-weight:700;}
.nav-menu{display:flex;gap:2rem;align-items:center;}
.nav-menu li a{color:#2D3436;font-weight:500;transition:0.3s;}
.nav-menu li a:hover{color:#00BFA6;}
.nav-toggle{display:none;font-size:1.8rem;cursor:pointer;color:#000;}

/* Hero */
.page-hero{background:linear-gradient(135deg,#00BFA6,#FDCB6E);padding:150px 20px 80px;text-align:center;color:white;border-bottom-left-radius:50px;border-bottom-right-radius:50px;}
.page-hero h1{font-size:3rem;font-weight:700;margin-bottom:1rem;}
.page-hero p{font-size:1.2rem;font-weight:500;opacity:0.9;}

/* Trips Section */
.page-content{max-width:1100px;margin:0 auto;padding:80px 20px;}
.trips-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:25px;}

/* Trip Card */
.trip-card{
  background:white;
  border-radius:20px;
  box-shadow:0 8px 25px rgba(0,0,0,0.08);
  transition:all 0.3s ease;
  overflow:hidden;
  display:flex;
  flex-direction:column;
}
.trip-card:hover{
  transform:translateY(-5px);
  box-shadow:0 15px 30px rgba(0,0,0,0.15);
}

/* Trip Image */
.trip-card img{
  width:100%;
  height:180px;
  object-fit:cover;
  border-bottom:3px solid #00BFA6;
}

/* Trip Content */
.trip-content{padding:20px;flex-grow:1;}
.trip-content h3{color:#00BFA6;margin-bottom:10px;font-size:1.3rem;}
.trip-content p{color:#555;margin-bottom:6px;font-size:0.95rem;}
.trip-content span{
  display:inline-block;
  background:linear-gradient(135deg,#00BFA6,#FDCB6E);
  color:white;
  padding:6px 12px;
  border-radius:8px;
  font-size:0.85rem;
  font-weight:500;
  margin-top:8px;
}

/* Loader + No Trips */
.loader{text-align:center;margin-top:60px;font-weight:600;color:#00BFA6;}
.no-trips{text-align:center;margin-top:50px;font-size:1.2rem;color:#555;}

/* Back Button */
.back-btn{display:inline-block;margin-top:30px;padding:10px 25px;border-radius:10px;background:linear-gradient(135deg,#00BFA6,#FDCB6E);color:white;font-weight:600;transition:0.3s;}
.back-btn:hover{opacity:0.9;}

/* Responsive */
@media(max-width:768px){
  .nav-menu{display:none;flex-direction:column;background:white;position:absolute;top:70px;right:20px;width:200px;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.1);}
  .nav-menu.active{display:flex;}
  .nav-toggle{display:block;}
  .page-hero h1{font-size:2.2rem;}
}
@media(max-width:480px){
  .trip-card img{height:150px;}
  .trip-content h3{font-size:1.1rem;}
  .page-hero h1{font-size:1.8rem;}
}
</style>
</head>

<body>
<nav class="navbar">
  <div class="nav-container">
    <div class="nav-logo"><h2>TravelBuddy</h2></div>
    <i class="fas fa-bars nav-toggle" id="menuToggle"></i>
    <ul class="nav-menu" id="navMenu">
      <li><a href="index.html">Home</a></li>
      <li><a href="find-companion.html">Find Companion</a></li>
      <li><a href="explore-trips.html">Explore Trips</a></li>
      <li><a href="profile.html">Profile</a></li>
    </ul>
  </div>
</nav>

<section class="page-hero">
  <h1>My Trips</h1>
  <p>All your travel adventures in one place üåç</p>
</section>

<section class="page-content">
  <div id="loader" class="loader">Loading your trips...</div>
  <div id="tripsContainer" class="trips-grid"></div>
  <div class="no-trips" id="noTripsMsg" style="display:none;">No trips found. Start your first journey today!</div>
  <div style="text-align:center;">
    <a href="profile.html" class="back-btn">‚Üê Back to Profile</a>
  </div>
</section>

<script>
// Navbar toggle
const menuToggle=document.getElementById("menuToggle");
const navMenu=document.getElementById("navMenu");
menuToggle.addEventListener("click",()=>navMenu.classList.toggle("active"));

// Elements
const user = JSON.parse(localStorage.getItem("user"));
const tripsContainer = document.getElementById("tripsContainer");
const noTripsMsg = document.getElementById("noTripsMsg");
const loader = document.getElementById("loader");

// Random Unsplash travel images
const travelImages = [
  "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1000&q=60",
  "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1000&q=60",
  "https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1000&q=60",
  "https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?auto=format&fit=crop&w=1000&q=60",
  "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1000&q=60",
  "https://images.unsplash.com/photo-1519817914152-22f90e8a8c32?auto=format&fit=crop&w=1000&q=60",
  "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1000&q=60"
];

// Load trips from MongoDB
async function loadTrips() {
  if (!user || !user.email) {
    loader.innerHTML = '<p style="color:red;">Please log in to view your trips.</p>';
    return;
  }

  try {
    const response = await fetch(`/api/user-trips/${encodeURIComponent(user.email)}`);
    const data = await response.json();

    loader.style.display = "none"; // Hide loader

    if (!data.success || !data.trips.length) {
      noTripsMsg.style.display = "block";
      return;
    }

    tripsContainer.innerHTML = "";
    data.trips.reverse().forEach((trip, index) => {
      const imgUrl = travelImages[index % travelImages.length]; // assign random images cyclically
      const div = document.createElement("div");
      div.className = "trip-card";
      div.innerHTML = `
        <img src="${imgUrl}" alt="Trip image">
        <div class="trip-content">
          <h3>${trip.destination || 'Unknown Destination'}</h3>
          <p><strong>Date:</strong> ${trip.date || 'N/A'}</p>
          <p><strong>College:</strong> ${trip.college || 'N/A'}</p>
          <p><strong>Distance:</strong> ${trip.distance || '‚Äî'} km</p>
          <p>${trip.description ? trip.description.slice(0,100)+'...' : 'No description available.'}</p>
          <span>Trip #${index + 1}</span>
        </div>
      `;
      tripsContainer.appendChild(div);
    });
  } catch (err) {
    console.error("Error fetching trips:", err);
    loader.innerHTML = '<p style="color:red;">Error loading trips. Please try again later.</p>';
  }
}

loadTrips();
</script>

</body>
</html>
