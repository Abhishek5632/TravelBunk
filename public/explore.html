<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Explore Trips | TravelMate</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Poppins',sans-serif;background:#f9f9f9;line-height:1.6;}
.navbar{background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);position:fixed;top:0;width:100%;z-index:1000;box-shadow:0 2px 20px rgba(0,191,166,0.1);}
.nav-container{max-width:1200px;margin:0 auto;padding:0 20px;display:flex;justify-content:space-between;align-items:center;height:70px;}
.nav-logo h2{color:#00BFA6;font-size:1.8rem;font-weight:700;}
.nav-menu{display:flex;list-style:none;gap:2rem;}
.nav-menu li a{text-decoration:none;color:#2D3436;font-weight:500;font-size:1rem;position:relative;}
.nav-menu li a:hover{color:#00BFA6;}
.nav-menu li a::after{content:'';position:absolute;width:0;height:2px;background:#00BFA6;bottom:-5px;left:0;transition:0.3s;}
.nav-menu li a:hover::after{width:100%;}
.hamburger{display:none;flex-direction:column;cursor:pointer;}
.hamburger span{width:25px;height:3px;background:#2D3436;margin:3px 0;border-radius:2px;}
@media(max-width:768px){.nav-menu{position:fixed;top:70px;left:-100%;flex-direction:column;background:white;width:100%;padding:2rem 0;transition:0.3s;box-shadow:0 10px 27px rgba(0,0,0,0.05);}
.nav-menu.active{left:0;}.hamburger{display:flex;}}

.container{max-width:700px;margin:120px auto 50px;padding:20px;background:white;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
.container h2{color:#00BFA6;margin-bottom:20px;}
.container input, .container button{width:100%;padding:10px;margin:10px 0;border-radius:6px;border:1px solid #ccc;}
.container button{background:#00BFA6;color:white;border:none;cursor:pointer;}
.container button:hover{background:#01967f;}
</style>
</head>
<body>

<nav class="navbar">
<div class="nav-container">
  <div class="nav-logo"><h2>TravelMate</h2></div>
  <ul class="nav-menu">
    <li><a href="index.html">Home</a></li>
    <li><a href="find-companion.html">Find Companion</a></li>
    <li><a href="explore.html">Explore Trips</a></li>
    <li><a href="contact.html">Contact</a></li>
  </ul>
  <div class="hamburger"><span></span><span></span><span></span></div>
</div>
</nav>

<div class="container">
<h2>Add Your Trip</h2>
<input type="text" id="email" placeholder="Your Email">
<input type="text" id="college" placeholder="College (if student)">
<input type="date" id="date">
<input type="text" id="destination" placeholder="Destination">
<button id="addTripBtn">Add Trip</button>
<p id="msg"></p>
</div>

<script>
const hamburger=document.querySelector(".hamburger");
const navMenu=document.querySelector(".nav-menu");
hamburger.addEventListener("click",()=>{ navMenu.classList.toggle("active"); });

const user = JSON.parse(localStorage.getItem("user"));
if(user){
  document.getElementById("email").value = user.email;
  document.getElementById("email").disabled = true; // prevent editing
}

document.getElementById("addTripBtn").addEventListener("click", async ()=>{
    const email=document.getElementById("email").value.trim();
    const college=document.getElementById("college").value.trim();
    const date=document.getElementById("date").value;
    const destination=document.getElementById("destination").value.trim();
    const msg=document.getElementById("msg");

    if(!email || !date || !destination){
        msg.style.color="red"; msg.textContent="Please fill all required fields!";
        return;
    }

    try {
      const res = await fetch("/api/add-trip", {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body: JSON.stringify({ email, college, date, destination })
      });

      const data = await res.json();
      if(data.success){
    msg.style.color="green";
    msg.textContent="✅ Trip added successfully!";
    document.getElementById("college").value="";
    document.getElementById("date").value="";
    document.getElementById("destination").value="";

    // Update profile page instantly
    if(window.opener){
        // Request profile page to fetch fresh data
        if(typeof window.opener.fetchLatestUser === "function"){
            window.opener.fetchLatestUser();
        }
    }
}

    msg.style.color="green";
    msg.textContent="✅ Trip added successfully!";
    document.getElementById("college").value="";
    document.getElementById("date").value="";
    document.getElementById("destination").value="";

    // Update profile page instantly if open
    if(localStorage.getItem("user")){
        const profileUser = JSON.parse(localStorage.getItem("user"));
        if(!profileUser.trips) profileUser.trips = [];
        profileUser.trips.push({ college, date, destination });
        localStorage.setItem("user", JSON.stringify(profileUser));

        // Call populateProfile on profile page if function exists
        if(window.opener && typeof window.opener.populateProfile === "function"){
            window.opener.populateProfile();
        }
    }

else{
          msg.style.color="red";
          msg.textContent="❌ "+data.message;
      }
    } catch(err){
      console.error(err);
      msg.style.color="red";
      msg.textContent="❌ Server error!";
    }
});
</script>

</body>
</html>
